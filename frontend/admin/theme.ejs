<!DOCTYPE html>
<html lang="en">
<%- include('../components/head') %>
<!-- Tailwind (added per request) -->
<script src="https://cdn.tailwindcss.com"></script>

<body class="<%= theme.background %> <%= theme.textColor %> font-[Figtree] min-h-screen flex">

  <!-- Sidebar -->
  <%- include('../components/admin_sidebar.ejs') %>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Navbar -->
    <%- include('../components/nav.ejs') %>

    <!-- Theme Management -->
    <main class="p-10 grid grid-cols-1 gap-6">
      <div class="rounded-xl p-6 shadow-lg border border-[#2a2a2a]">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-2xl font-bold text-white flex items-center gap-2">
            <i data-lucide="palette" class="w-6 h-6"></i>
            Theme Settings
          </h1>
        </div>

        <% if (themes.length === 0) { %>
          <!-- No theme -->
          <p class="text-gray-400">No theme found. The system will fall back to the default:</p>
          <div class="mt-3 px-4 py-2 rounded-lg border border-[#2a2a2a] bg-neutral-900 inline-block">
            <code class="text-green-400 font-mono"><%= activeTheme || 'bg-neutral-950 text-white' %></code>
          </div>
        <% } else { %>
          <!-- Single Theme -->
          <% const t = themes[0]; %>
          <div class="p-6 rounded-xl border border-[#2a2a2a] shadow bg-opacity-0">
            <h2 class="text-lg font-semibold text-white mb-4">Current Theme</h2>
            <div class="mb-4 space-y-1">
              <p class="text-gray-400">Name: <span class="text-white font-medium"><%= t.name %></span></p>
              <p class="text-gray-400">Background: <code class="text-gray-300"><%= t.background %></code></p>
              <p class="text-gray-400">Text Color: <code class="text-gray-300"><%= t.textColor %></code></p>
              <p class="text-gray-400">Button/Display Color: <code class="text-gray-300"><%= t.buttonColor %></code></p>

              <div class="mt-2">
                <!-- Preview uses theme's buttonColor if present, otherwise global activeButton -->
                <button class="px-4 py-2 rounded-lg <%= t.buttonColor || activeButton %> <%= t.textColor || 'text-white' %>">
                  Preview Button
                </button>
              </div>
            </div>

            <div class="flex gap-3 mt-4">
              <!-- Set Theme (uses active-button for visual consistency if you want, kept green for clarity) -->
              <form method="POST" action="/admin/theme/set/<%= t.id %>">
                <button type="submit"
                  class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 text-white font-medium transition">
                  Set as Active
                </button>
              </form>

              <!-- Edit Theme (opens modal) -->
              <button onclick="openEditModal('<%= t.id %>', '<%= t.name %>', '<%= t.background %>', '<%= t.textColor %>', '<%= t.buttonColor %>')"
                class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-medium transition">
                Edit
              </button>
            </div>
          </div>
        <% } %>
      </div>
    </main>
  </div>

  <!-- Edit Theme Modal -->
  <div id="editModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
    <div class="bg-neutral-950 p-6 rounded-xl shadow-lg border border-[#2a2a2a] w-full max-w-lg">
      <h2 class="text-xl font-bold text-white mb-4">Edit Theme</h2>
      <form id="editForm" method="POST">
        <div class="space-y-4">
          <div>
            <label class="block text-gray-400 text-sm mb-1">Name</label>
            <input type="text" name="name" id="editName"
              class="w-full px-3 py-2 rounded-lg bg-neutral-900 border border-[#2a2a2a] text-white focus:outline-none focus:border-blue-500"
              required>
          </div>

          <div>
            <label class="block text-gray-400 text-sm mb-1">Background</label>
            <input type="text" name="background" id="editBackground"
              class="w-full px-3 py-2 rounded-lg bg-neutral-900 border border-[#2a2a2a] text-white focus:outline-none focus:border-blue-500"
              placeholder="bg-neutral-950" required>
          </div>

          <div>
            <label class="block text-gray-400 text-sm mb-1">Text Color</label>
            <input type="text" name="textColor" id="editTextColor"
              class="w-full px-3 py-2 rounded-lg bg-neutral-900 border border-[#2a2a2a] text-white focus:outline-none focus:border-blue-500"
              placeholder="text-white" required>
          </div>

          <div>
            <label class="block text-gray-400 text-sm mb-1">Button/Display Color</label>
            <input type="text" name="buttonColor" id="editButtonColor"
              class="w-full px-3 py-2 rounded-lg bg-neutral-900 border border-[#2a2a2a] text-white focus:outline-none focus:border-blue-500"
              placeholder="bg-neutral-800" required>
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-3">
          <button type="button" onclick="closeEditModal()"
            class="px-4 py-2 rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition">Cancel</button>
          <button type="submit"
            class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white transition">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    lucide.createIcons();

    function openEditModal(id, name, background, textColor, buttonColor) {
      document.getElementById('editName').value = name || '';
      document.getElementById('editBackground').value = background || '';
      document.getElementById('editTextColor').value = textColor || '';
      document.getElementById('editButtonColor').value = buttonColor || '';
      document.getElementById('editForm').action = '/admin/theme/edit/' + id;
      document.getElementById('editModal').classList.remove('hidden');
      document.getElementById('editModal').classList.add('flex');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('flex');
      document.getElementById('editModal').classList.add('hidden');
    }
  </script>

</body>
</html>
