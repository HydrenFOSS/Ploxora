<!DOCTYPE html>
<html lang="en">
   <%- include('../components/head') %>
   <body class="min-h-screen text-white relative flex flex-col">
     <div class="absolute inset-0 flex flex-col">
  <!-- Top gradient -->
  <div class="h-1/2 bg-gradient-to-b from-[#000000] to-[#111111]"></div>
  <!-- Bottom gradient -->
  <div class="h-1/2 bg-gradient-to-b from-[#111111] to-[#000000]"></div>
</div>
      <!-- Navbar -->
      <%- include('../components/nav.ejs') %>
      <div class="flex flex-1 relative z-10">
         <%- include('../components/sidebar.ejs') %>
         <!-- Main content -->
         <main class="flex-1 p-6 space-y-8">
            <!-- Users Table -->
            <section>
               <div class="flex items-center justify-between mb-4">
                  <h2 class="text-2xl font-semibold text-gray-200 tracking-wide">Dashboard Users</h2>
               </div>
               <% if (req.query.msg === "USER_BANNED" || req.query.msg === "USER_UNBANNED" || req.query.msg === "SERVER_CREATED" || req.query.msg === "SERVER_DELETED" || req.query.msg === "NODE_DELETED" || req.query.msg === "NODE-CREATED" || req.query.msg === "IMAGE_CREATED" || req.query.msg === "IMAGE_DELETED") { %>
               <div class="mb-4 p-4 rounded-lg flex items-start space-x-3 
                  <%= req.query.msg.includes('BANNED') || req.query.msg.includes('CREATED') ? 'bg-green-600 text-white' : 'bg-blue-600 text-white' %>">
                  <!-- Icon -->
                  <div class="flex-shrink-0 flex flex-col justify-center">
                     <% if (req.query.msg.includes('BANNED') || req.query.msg.includes('CREATED')) { %>
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                     </svg>
                     <% } else { %>
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01" />
                     </svg>
                     <% } %>
                  </div>
                  <!-- Texts -->
                  <div class="flex flex-col">
                     <p class="font-semibold leading-tight">
                        <% if (req.query.msg === "USER_BANNED") { %>User Banned<% } %>
                        <% if (req.query.msg === "USER_UNBANNED") { %>User Unbanned<% } %>
                        <% if (req.query.msg === "SERVER_CREATED") { %>Server Created<% } %>
                        <% if (req.query.msg === "SERVER_DELETED") { %>Server Deleted<% } %>
                        <% if (req.query.msg === "NODE-CREATED") { %>Node Created<% } %>
                        <% if (req.query.msg === "NODE_DELETED") { %>Node Deleted<% } %>
                        <% if (req.query.msg === "IMAGE_CREATED") { %>Image Created<% } %>
                        <% if (req.query.msg === "IMAGE_DELETED") { %>Image Deleted<% } %>
                     </p>
                     <p class="text-sm leading-tight">
                        <% if (req.query.msg === "USER_BANNED") { %>User was successfully banned<% } %>
                        <% if (req.query.msg === "USER_UNBANNED") { %>User was successfully unbanned<% } %>
                        <% if (req.query.msg === "SERVER_CREATED") { %>Server deployed successfully<% } %>
                        <% if (req.query.msg === "SERVER_DELETED") { %>Server deleted successfully<% } %>
                        <% if (req.query.msg === "NODE-CREATED") { %>Node added successfully<% } %>
                        <% if (req.query.msg === "NODE_DELETED") { %>Node deleted successfully<% } %>
                        <% if (req.query.msg === "IMAGE_CREATED") { %>Image added successfully<% } %>
                        <% if (req.query.msg === "IMAGE_DELETED") { %>Image deleted successfully<% } %>
                     </p>
                  </div>
               </div>
               <% } %>
               <div class="overflow-x-auto rounded-2xl shadow-lg border border-[#2a2a2a]">
                  <table
                     class="min-w-full bg-neutral-950 rounded-2xl overflow-hidden">
                     <thead>
                        <tr class="bg-neutral-950 text-left text-gray-300 text-sm uppercase tracking-wide">
                           <th class="px-6 py-3">Profile</th>
                           <th class="px-6 py-3">Username</th>
                           <th class="px-6 py-3">Email</th>
                           <th class="px-6 py-3">ID</th>
                           <th class="px-6 py-3">Role</th>
                           <th class="px-6 py-3">Actions</th>
                           <!-- NEW -->
                        </tr>
                     </thead>
                     <tbody>
                        <% if (Array.isArray(users) && users.length> 0) { %>
                        <% users.forEach(function(u, index) { %>
                  <tr class="transition hover:bg-neutral-800 <%= index % 2 === 0 ? 'bg-stone-950' : 'bg-stone-950' %>">
                           <td class="px-6 py-3">
                              <img src="<%= u.profilePicture %>" alt="<%= u.username %>"
                                 class="w-8 h-8 rounded-full">
                           </td>
                           <td class="px-6 py-3 text-gray-200">
                              <%= u.username %>
                           </td>
                           <td class="px-6 py-3 text-gray-300">
                              <%= u.email %>
                           </td>
                           <td class="px-6 py-3 text-gray-300">
                              <%= u.id %>
                           </td>
                           <td class="px-6 py-3">
                              <div class="flex items-center justify-center space-x-2">
                                 <% if (u.admin) { %>
                                 <div
                                    class="relative inline-flex items-center px-4 py-1 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 text-white font-semibold shadow-md">
                                    <span
                                       class="absolute inset-0 rounded-full opacity-30 bg-yellow-500 animate-pulse"></span>
                                    <span class="relative flex items-center space-x-1">
                                       <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                          viewBox="0 0 24 24" stroke-width="1.5"
                                          stroke="currentColor" class="size-6">
                                          <path stroke-linecap="round"
                                             stroke-linejoin="round"
                                             d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z" />
                                       </svg>
                                       <span>Admin</span>
                                    </span>
                                 </div>
                                 <% } else { %>
                                 <div
                                    class="inline-flex items-center px-3 py-1 rounded-full bg-gray-300/50 text-gray-100 font-medium">
                                    <span class="mr-1">
                                       <svg xmlns="http://www.w3.org/2000/svg"
                                          fill="none" viewBox="0 0 24 24"
                                          stroke-width="1.5" stroke="currentColor"
                                          class="size-6">
                                          <path stroke-linecap="round"
                                             stroke-linejoin="round"
                                             d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                       </svg>
                                    </span>
                                    <span>
                                    <%= u.banned ? 'Banned' : 'User' %>
                                    </span>
                                 </div>
                                 <% } %>
                              </div>
                           </td>
                           <td class="px-6 py-3">
                              <div class="flex items-center space-x-2 justify-center">
                                 <% if (u.username===user.username) { %>
                                 <button disabled
                                    class="bg-gray-600 text-gray-400 text-sm px-3 py-1 rounded-xl cursor-not-allowed">Cannot</button>
                                 <% } else { %>
                                 <!-- Delete -->
                                 <form action="/admin/users/<%= u.id %>?_method=DELETE"
                                    method="POST"
                                    onsubmit="return confirm('Are you sure you want to delete <%= u.username %>?');">
                                    <button type="submit"
                                       class="bg-red-600 hover:bg-red-700 text-white text-sm px-3 py-1 rounded-xl transition">Delete</button>
                                 </form>
                                 <!-- Ban/Unban -->
                                 <% if (!u.banned) { %>
                                 <form action="/admin/users/ban/<%= u.id %>"
                                    method="POST">
                                    <button type="submit"
                                       class="bg-yellow-600 hover:bg-yellow-700 text-white text-sm px-3 py-1 rounded-xl transition">Ban</button>
                                 </form>
                                 <% } else { %>
                                 <form action="/admin/users/unban/<%= u.id %>"
                                    method="POST">
                                    <button type="submit"
                                       class="bg-green-600 hover:bg-green-700 text-white text-sm px-3 py-1 rounded-xl transition">Unban</button>
                                 </form>
                                 <% } %>
                                 <% } %>
                              </div>
                           </td>
                        </tr>
                        <% }) %>
                        <% } else { %>
                        <tr>
                           <td colspan="6"
                              class="text-center px-6 py-6 text-gray-500 italic">No users
                              yet.
                           </td>
                        </tr>
                        <% } %>
                     </tbody>
                  </table>
               </div>
            </section>
         </main>
      </div>
      <%- include('../components/footer.ejs') %>
   </body>
</html>