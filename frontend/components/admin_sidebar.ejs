<!-- Mobile toggle button -->
<button id="sidebarToggle" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-2xl bg-neutral-900 text-white hover:bg-neutral-800 transition">
  <i data-lucide="menu" class="w-6 h-6"></i>
</button>

<!-- Sidebar -->
<aside id="sidebar"
  class="fixed md:static inset-y-0 left-0 w-64 bg-neutral-950 p-6 flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40 border border-neutral-900">

  <div class="mb-8 flex justify-center items-center gap-3">
    <img src="/uploads/logo.png" alt="Ploxora Logo" class="h-10 w-auto">
    <h1 class="text-xl font-bold text-white"><%= name %></h1>
  </div>
  <!-- Divider -->
  <hr class="border-neutral-900 mb-4">
<div class="relative w-full">
  <button id="userMenuButton" type="button"
    class="transition flex items-center gap-3 w-full px-4 py-2 text-left rounded-xl bg-[#0d0d0d] hover:bg-neutral-900 text-white">
    <img src="<%= user.profilePicture %>" alt="User" class="rounded-full h-8 w-8 border border-neutral-700">
    <span class="truncate"><%= user.username %></span>
    <i id="userMenuChevron" data-lucide="chevron-right" class="ml-auto w-4 h-4 transition-transform"></i>
  </button>

  <div id="userMenu"
       class="absolute top-1/2 left-[calc(100%+0.5rem)] -translate-y-1/2 w-56
              bg-neutral-900 border border-neutral-800 rounded-xl shadow-lg z-50
              transition-all duration-200 ease-out
              opacity-0 translate-x-2 scale-95 pointer-events-none invisible">
    <div class="px-4 py-3 text-sm text-gray-300 border-b border-neutral-800">
      <p class="font-medium truncate"><%= user.username %></p>
      <p class="text-gray-500 text-xs truncate"><%= user.email %></p>
    </div>
    <ul class="py-2 text-white text-sm">
      <li><a href="/settings" class="block px-4 py-2 hover:bg-neutral-800">Settings</a></li>
      <li><a href="/logout" class="block px-4 py-2 hover:bg-neutral-800">Logout</a></li>
    </ul>
  </div>
</div>

  <!-- Divider -->
  <hr class="border-neutral-900 my-4">

  <nav class="space-y-3">
    <% if (user.admin) { %>
    <a href="/dashboard" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="arrow-left" class="w-5 h-5"></i> Go Back
    </a>

    <a href="/admin/overview" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="table-of-contents" class="w-5 h-5"></i> Overview
    </a>

    <a href="/admin/settings" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="shield" class="w-5 h-5"></i> Settings
    </a>
    
    <a href="/admin/nodes" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="server" class="w-5 h-5"></i> Nodes
    </a>

    <a href="/admin/users" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="users" class="w-5 h-5"></i> Users
    </a>

    <a href="/admin/servers" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="database" class="w-5 h-5"></i> VPS Instances
    </a>

    <a href="/admin/addons" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
      <i data-lucide="puzzle" class="w-5 h-5"></i> Addons
    </a>

    <div class="px-4 pt-4">
      <span class="text-xs font-semibold tracking-wide text-gray-500">---------- ADDONS ----------</span>
    </div>

    <% addons.forEach(a => { %>
      <% if (a.status === "enabled" && a.sidebar && a.sidebar.length > 0) { %>
        <% a.sidebar.forEach(s => { %>
          <% if (s.for === "admin") { %>
            <a href="<%= s.path %>" 
               class="flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-950 text-white hover:bg-netural-950 transition border border-[#2a2a2a] hover:border-neutral-600">
              <i data-lucide="<%= s.icon || 'puzzle' %>" class="w-5 h-5"></i>
              <%= s.text || a.name %>
            </a>
          <% } %>
        <% }) %>
      <% } %>
    <% }) %>

    <% } %>
  </nav>

  <div class="mt-auto pt-6 border-t border-neutral-800">
    <span class="text-xs text-gray-500">&copy; 2025 Ploxora</span>
  </div>
</aside>
<script>
  const userMenuButton = document.getElementById("userMenuButton");
  const userMenu = document.getElementById("userMenu");
  const userMenuChevron = document.getElementById("userMenuChevron");

  function openMenu() {
    userMenu.classList.remove("opacity-0","translate-x-2","scale-95","pointer-events-none","invisible");
    userMenuChevron && userMenuChevron.classList.add("rotate-90");
  }
  function closeMenu() {
    userMenu.classList.add("opacity-0","translate-x-2","scale-95","pointer-events-none","invisible");
    userMenuChevron && userMenuChevron.classList.remove("rotate-90");
  }
  function isOpen() {
    return !userMenu.classList.contains("invisible");
  }

  if (userMenuButton) {
    userMenuButton.addEventListener("click", (e) => {
      e.stopPropagation();
      isOpen() ? closeMenu() : openMenu();
    });
  }

  document.addEventListener("click", (e) => {
    if (isOpen() && !userMenu.contains(e.target) && !userMenuButton.contains(e.target)) {
      closeMenu();
    }
  });

  // Optional: on small screens, fall back to opening UNDER the button
  const mq = window.matchMedia("(max-width: 767px)");
  function applyMobilePosition() {
    if (mq.matches) {
      userMenu.style.left = "0";
      userMenu.style.top = "100%";
      userMenu.style.transform = "translateY(0)"; // base; transitions still apply via classes
    } else {
      userMenu.style.left = "calc(100% + 0.5rem)";
      userMenu.style.top = "50%";
      userMenu.style.transform = "translateY(-50%)";
    }
  }
  applyMobilePosition();
  mq.addEventListener("change", applyMobilePosition);
</script>
<script>
  const sidebar = document.getElementById("sidebar");
  const toggle = document.getElementById("sidebarToggle");

  toggle.addEventListener("click", () => {
    sidebar.classList.toggle("-translate-x-full");
  });
</script>
