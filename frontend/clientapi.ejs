<!DOCTYPE html>
<html lang="en">
<%- include('components/head') %>

<body class="bg-neutral-950 text-gray-300 font-[Figtree] min-h-screen flex">

  <!-- Sidebar -->
  <%- include('components/sidebar.ejs') %>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Navbar -->
    <%- include('components/nav.ejs') %>

    <!-- Client API Keys Page -->
    <main class="p-10">
      <div class="mb-6 text-center">
        <h2 class="text-3xl font-bold text-white mb-2">Client API Keys</h2>
        <p class="text-gray-400 text-sm">Manage your client API keys securely.</p>
      </div>

      <!-- Create API Key -->
      <div class="mb-6 flex justify-center text-center">
        <form id="createKeyForm" class="flex gap-4 items-center bg-neutral-900 border border-[#2a2a2a] rounded-xl p-6 shadow-lg w-45 max-w-2xl">
          <button 
            type="submit"
            class="bg-green-600 hover:bg-green-500 text-white font-semibold px-6 py-2 rounded-lg transition shadow"
          >
            Create Key
          </button>
        </form>
      </div>

      <!-- API Keys List -->
      <div class="grid grid-cols-1 gap-4 max-w-4xl mx-auto">
        <% if (apikeys && apikeys.length > 0) { %>
          <% apikeys.forEach(key => { %>
            <div class="bg-neutral-900 border border-[#2a2a2a] rounded-xl p-6 shadow-lg flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold text-white"><%= key.name %></h3>
                <p class="text-sm text-gray-400">Key: <span class="transition blur-sm hover:blur-none text-gray-200 font-mono"><%= key.key %></span></p>
                <p class="text-xs text-gray-500">Created: <%= new Date(key.createdAt).toLocaleString() %></p>
              </div>
              <button 
                class="deleteKey bg-red-600 hover:bg-red-500 text-white font-semibold px-4 py-2 rounded-lg transition shadow"
                data-id="<%= key.key %>"
              >
                Delete
              </button>
            </div>
          <% }) %>
        <% } else { %>
          <p class="text-gray-500 italic text-center">No API keys created yet.</p>
        <% } %>
      </div>
    </main>
    <%- include('components/footer.ejs') %>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Create new API key
      const form = document.getElementById("createKeyForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
      //  const name = formData.get("name");

        try {
          const res = await fetch("/client/api/create", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
         //   body: JSON.stringify({ name })
          });

          if (!res.ok) throw new Error("Failed to create key");
          location.reload();
        } catch (err) {
          alert("Error: " + err.message);
        }
      });

      // Delete API key
      document.querySelectorAll(".deleteKey").forEach(btn => {
        btn.addEventListener("click", async () => {
          const id = btn.dataset.id;
          if (!confirm("Are you sure you want to delete this API key?")) return;

          try {
            const res = await fetch(`/client/api/delete/${id}`, { method: "DELETE" });
            if (!res.ok) throw new Error("Failed to delete key");
            location.reload();
          } catch (err) {
            alert("Error: " + err.message);
          }
        });
      });
    });
    lucide.createIcons();
  </script>
</body>
</html>
